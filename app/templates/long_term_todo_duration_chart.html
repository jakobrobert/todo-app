<canvas id="chart" width="400" height="400"></canvas>

<!--
Inline script is hacky, but did not manage to do it in the recommended way.
If trying: url_for('static', filename='js/l----------------ong_term_todo_duration_chart.js')
Then it adds 'static' to the root of the webpage and does not add the url prefix (see URL_PREFIX in todo_app.py)
-->
<script>
    const canvas = document.getElementById("chart");
    const ctx = canvas.getContext("2d");

    function convertDurationFromSecondsToFormattedString(seconds) {
        const date = new Date(0);
        date.setSeconds(seconds);

        // Need to adjust. E.g. for GMT+1, hours would be 1 too large
        const timezoneOffsetSeconds = date.getTimezoneOffset() * 60;
        date.setSeconds(timezoneOffsetSeconds);

        const timeString = date.toTimeString();
        const timeStringParts = timeString.split(" ");

        return timeStringParts[0];
    }

    const chart = new Chart(ctx, {
        type: "line",
        data: {
            // safe -> Jinja2 pastes the data directly and does not convert it to a string
            labels: {{ labels | safe }},
            datasets:
            [
                {
                    label: "Duration",
                    data: {{ values | safe }},
                    fill: false,
                    borderColor: "gray",
                    borderWidth: 1.0,
                    lineTension: 0.1,
                    lineWidth: 1.0
                }
            ]
        },
        options: {
            responsive: false,
            elements: {
                point: {
                    radius: 2.0
                }
            },
            scales: {
                y: {
                    ticks: {
                        // Returns the label on the y axis
                        callback: function(value, index, values) {
                            return convertDurationFromSecondsToFormattedString(value);
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        // Returns the tooltip label which is shown when hovering over a data point
                        label: function(context) {
                            return convertDurationFromSecondsToFormattedString(context.parsed.y);
                        }
                    }
                }
            }
        }
    });
</script>
